<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
  <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
  <link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet">
  <link rel=stylesheet type=text/css href="{{url_for('static', filename='styles.css') }}">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>

  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.12.4  /jquery.min.js">
    </script>
    <script src="https://apis.google.com/js/client:platform.js?onload=start" async defer>
    </script>
<script>
   function start() {
     gapi.load('auth2', function() {
       auth2 = gapi.auth2.init({
         client_id: '786894785941-u1r95lsln48s59k6ukof5f8911s4a9br.apps.googleusercontent.com',
         // Scopes to request in addition to 'profile' and 'email'
         //scope: 'additional_scope'
       });
     });
   }
 </script>
</head>
<body>
  <nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top">
    <a class="navbar-brand" href="#">CATALOG APP </a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav mr-auto">
        <li class="nav-item  ">
          <a class="nav-link " href="{{url_for('showCategories')}}">HOME</a>
        </li>




      </ul>

      <div class="input-group col-md-4">
        <input class="form-control py-2" type="search" value="" placeholder="search" id="example-search-input">
        <span class="input-group-append">
          <button class="btn" type="button">
            <i class="fa fa-search" style="color: grey"></i>
          </button>
          {%if 'username' not in session %}

          <div class="container">

            <!-- Button to Open the Modal -->
            <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#myModal">
              LOG IN
            </button>

        </span>
      </nav>

  <!-- The Modal -->
  <div class="modal fade" id="myModal">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">

        <!-- Modal Header -->
        <div class="modal-header">
          <h4 class="modal-title">Log In</h4>
          <button type="button" class="close" data-dismiss="modal">&times;</button>
        </div>

        <!-- Modal body -->
        <div class="modal-body">





          <button id="signinButton">Sign in with Google</button>
          <div id="result"></div>

        <script>
            $('#signinButton').click(function() {

        function signInCallback(authResult) {
          if (authResult['code']) {

            // Hide the sign-in button now that the user is authorized, for example:
            $('#signinButton').attr('style', 'display: none');

            // Send the code to the server
            $.ajax({
              type: 'POST',
              url: '/gconnect?state={{STATE}}',
              // Always include an `X-Requested-With` header in every AJAX request,
              // to protect against CSRF attacks.
              headers: {
                'X-Requested-With': 'XMLHttpRequest'
              },
              contentType: 'application/octet-stream; charset=utf-8',
              success:function(result){
                      $('#result').html('Login Successful!</br>'+ result + '</br>Redirecting...')
                           setTimeout(function() {
                            window.location.href = "/category";
                           }, 2000);
                    },
                    processData:false,
                    data:authResult['code']
                  });
                } else{
                  // handle error
                  console.log('There was an error: ' + authResult['error']);
                  $('#result').html('Failed to make a server-side call. Check your configuration and console.');
                }
              }
              auth2.grantOfflineAccess().then(signInCallback);
            });
          </script>



        <div class="modal-footer">
          <button type="button" class="btn btn-danger"  data-dismiss="modal">CLOSE</button>
        </div>


        {% else %}

        <!-- Modal footer -->
        <div class="modal-footer">
          <button type="button" class="btn btn-danger" href="{{url_for('logout')}}" data-dismiss="modal">LOG OUT</button>
        </div>
        {% endif %}
      </nav>
      </div>
    </div>
  </div>

  </div>
</body>
</html>
